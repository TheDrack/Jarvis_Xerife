name: "â˜ï¸ Sync JARVIS to Google Drive"

on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›°ï¸ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: ğŸ”§ Install Dependencies
        run: |
          set -e
          python -m pip install --upgrade pip
          pip install \
            google-api-python-client \
            google-auth-httplib2 \
            google-auth-oauthlib \
            pyyaml

      - name: â˜ï¸ Run JARVIS Pipeline (Sync Drive)
        env:
          # ğŸ”‘ Segredos de domÃ­nio
          G_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
          DRIVE_FOLDER_ID: ${{ secrets.DRIVE_FOLDER_ID }}

          # ğŸ§  IntenÃ§Ã£o do pipeline (GERENTE â†’ SUPERVISOR)
          PIPELINE: sync_drive

          # (opcional) forÃ§a falha se algo der errado
          PIPELINE_STRICT: "true"

        run: |
          set -e

          echo "ğŸ“ Workspace: $(pwd)"
          echo "ğŸ Python: $(python --version)"
          echo "ğŸ§  Pipeline selecionado: $PIPELINE"

          # Garante que o pacote 'app' Ã© resolvÃ­vel
          export PYTHONPATH="$(pwd)"

          PIPELINE_RUNNER="app/runtime/pipeline_runner.py"

          if [ -f "$PIPELINE_RUNNER" ]; then
            echo "ğŸš€ Executando pipeline JARVIS..."
            python "$PIPELINE_RUNNER"
            echo "âœ… Pipeline executado com sucesso."
          else
            echo "âŒ Erro: pipeline_runner.py nÃ£o encontrado em app/runtime/"
            exit 1
          fi