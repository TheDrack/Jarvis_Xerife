name: "‚òÅÔ∏è Sync JARVIS to Google Drive"

on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: üõ∞Ô∏è Checkout Code
        uses: actions/checkout@v4

      - name: üì¶ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: üîß Install Dependencies
        run: |
          set -e
          python -m pip install --upgrade pip
          pip install \
            google-api-python-client \
            google-auth-httplib2 \
            google-auth-oauthlib

      - name: ‚òÅÔ∏è Consolidate and Upload to Google Drive
        env:
          G_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
          DRIVE_FOLDER_ID: ${{ secrets.DRIVE_FOLDER_ID }}
        run: |
          set -e

          echo "üìÅ Workspace: $(pwd)"

          export PYTHONPATH="$(pwd)"

          CONSOLIDATOR_PATH="app/infrastructure/consolidator.py"

          if [ -f "$CONSOLIDATOR_PATH" ]; then
            echo "üöÄ Executando consolidator..."
            python "$CONSOLIDATOR_PATH"
            echo "‚úÖ Upload conclu√≠do com sucesso."
          else
            echo "‚ùå Erro: consolidator.py n√£o encontrado em app/infrastructure/"
            exit 1
          fi