name: "‚òÅÔ∏è Sync JARVIS to Google Drive"

on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: üõ∞Ô∏è Checkout Code
        uses: actions/checkout@v4

      - name: üì¶ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: üîß Install Dependencies
        run: |
          set -e
          python -m pip install --upgrade pip
          pip install \
            google-api-python-client \
            google-auth-httplib2 \
            google-auth-oauthlib \
            pyyaml

      - name: ‚òÅÔ∏è Run JARVIS Pipeline (Sync Drive & Backups)
        env:
          G_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
          DRIVE_FOLDER_ID: ${{ secrets.DRIVE_FOLDER_ID }}
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GIST_PAT: ${{ secrets.GIST_PAT }} # <--- ADICIONADO AQUI
          PIPELINE: sync_drive
          PIPELINE_STRICT: "false" # <--- Importante para n√£o travar no erro do Drive
        run: |
          export PYTHONPATH="$(pwd)"
          python app/runtime/pipeline_runner.py
